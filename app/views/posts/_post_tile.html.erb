<%# 
  Post tile partial - displays a post in a card format
  Locals:
    - post: the post to display
%>

<div id="<%= dom_id(post) %>" class="group bg-white shadow-md rounded-lg p-6 hover:shadow-2xl hover:scale-[1.02] transform transition-all duration-300 ease-out relative cursor-pointer">
  <% if user_signed_in? && (post.user == current_user || current_user.admin?) %>
    <div class="absolute top-4 right-4 flex items-center space-x-2 z-10">
      <%= link_to edit_post_path(post), class: "text-gray-400 hover:text-gray-600 transition-colors p-1 bg-white rounded-full shadow-sm hover:shadow", title: "Edit" do %>
        <%= inline_svg_tag "edit.svg", class: "w-4 h-4" %>
      <% end %>
      <%= button_to post_path(post), method: :delete, data: { turbo_confirm: "Are you sure you want to delete this post?" }, class: "text-gray-400 hover:text-red-600 transition-colors p-1 bg-white rounded-full shadow-sm hover:shadow border-0 cursor-pointer", title: "Delete" do %>
        <%= inline_svg_tag "delete.svg", class: "w-4 h-4" %>
      <% end %>
    </div>
  <% end %>
  
  <%= link_to post_link_url(post), post_link_options(post).merge(class: "block cursor-pointer") do %>
    <% if post.success_story? && post.logo_svg.present? %>
      <div class="mb-4 h-48 rounded-lg flex justify-center items-center p-8 success-story-tile-logo">
        <%= raw post.logo_svg %>
      </div>
    <% elsif post.title_image_url.present? %>
      <div class="mb-4 aspect-video overflow-hidden rounded-lg">
        <%= image_tag post.title_image_url, alt: post.title, class: "w-full h-full object-cover" %>
      </div>
    <% end %>
    
    <div class="flex items-center justify-between mb-2">
      <div>
        <% unless post.success_story? %>
          <% if post.category %>
            <span class="text-sm text-gray-500"><%= post.category.name %></span>
          <% else %>
            <span class="text-sm text-gray-400 italic">Uncategorized</span>
          <% end %>
        <% end %>
      </div>
      <% if post.link? && (domain = extract_domain(post.url)) %>
        <span class="text-xs text-gray-400 underline inline-flex items-center gap-1">
          <%= domain %>
          <%= inline_svg_tag "external-link.svg", class: "w-3 h-3 text-gray-400" %>
        </span>
      <% end %>
    </div>
    
    <div class="flex items-start justify-between mb-2 gap-3">
      <h3 class="text-xl font-semibold text-gray-900 group-hover:text-red-600 transition-colors">
        <%= post.title %>
      </h3>
      <% if post.comments.any? %>
        <div class="flex items-center space-x-1 text-sm text-gray-500 flex-shrink-0">
          <%= inline_svg_tag "comment.svg", class: "w-4 h-4" %>
          <span><%= post.comments.count %></span>
        </div>
      <% end %>
    </div>
    
    <% if post.summary.present? %>
      <div class="text-gray-600 mb-4 prose prose-sm max-w-none">
        <%= raw markdown_to_html(post.summary) %>
      </div>
    <% end %>
    
    <div class="space-y-2">
      <div class="flex items-center justify-between">
        <div class="flex items-center space-x-2">
          <% if post.user.present? %>
            <% if post.user.avatar_url.present? %>
              <%= image_tag post.user.avatar_url, alt: post.user.display_name, class: "h-6 w-6 rounded-full" %>
            <% end %>
            <span class="text-sm text-gray-700"><%= post.user.display_name %></span>
          <% else %>
            <span class="text-sm text-gray-400 italic">[Deleted User]</span>
          <% end %>
        </div>
        
        <span class="text-xs text-gray-400"><%= format_post_date(post.created_at) %></span>
      </div>
    </div>
  <% end %>
</div>
