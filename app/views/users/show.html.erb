<%# Set meta tags for user profile %>
<% content_for :meta_title, t('meta.users.show.title', display_name: @user.display_name, username: @user.display_name) %>
<% 
  if @user.bio.present?
    content_for :meta_summary, t('meta.users.show.summary_with_bio', bio: @user.bio)
  else
    content_for :meta_summary, t('meta.users.show.summary_without_bio', display_name: @user.display_name)
  end
%>
<% content_for :meta_keywords, t('meta.users.show.keywords', username: @user.display_name) %>
<% if @user.avatar_url.present? %>
  <% content_for :meta_image, @user.avatar_url %>
<% end %>
<% content_for :meta_type, "profile" %>

<div class="space-y-8">
  <!-- Tabbed Content Section -->
  <div data-controller="tabs">
    <!-- Tab Navigation with User Info -->
    <div>
      <!-- Desktop layout: side by side -->
      <div class="hidden md:flex items-end justify-between gap-8">
        <!-- User info on the left -->
        <div class="flex items-center gap-6">
          <% if @user.avatar_url.present? %>
            <%= image_tag @user.avatar_url, alt: @user.display_name, class: "h-32 w-32 rounded-full flex-shrink-0" %>
          <% else %>
            <span class="h-32 w-32 rounded-full bg-gray-300 flex items-center justify-center text-5xl font-bold flex-shrink-0">
              <%= @user.display_name.first.upcase %>
            </span>
          <% end %>
          
          <div class="flex flex-col justify-center">
            <!-- First line: Name and social links -->
            <div class="flex items-baseline gap-3 mb-2">
              <h1 class="text-4xl font-bold text-gray-900"><%= @user.display_name %></h1>
              
              <!-- Social Links -->
              <% if @user.social_links.any? %>
                <div class="flex items-center gap-2 pb-1">
                  <% @user.social_links.each do |platform, url| %>
                    <% next unless url.present? %>
                    <%= link_to url, target: "_blank", rel: "noopener", class: "text-gray-400 hover:text-gray-600" do %>
                      <% case platform %>
                      <% when :github %>
                        <%= inline_svg_tag "github.svg", class: "w-5 h-5" %>
                      <% when :twitter %>
                        <%= inline_svg_tag "twitter.svg", class: "w-5 h-5" %>
                      <% when :website %>
                        <%= inline_svg_tag "globe.svg", class: "w-5 h-5" %>
                      <% when :linkedin %>
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                          <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                        </svg>
                      <% end %>
                    <% end %>
                  <% end %>
                </div>
              <% end %>
            </div>
            
            <!-- Second line: Bio -->
            <% if @user.bio.present? %>
              <p class="text-gray-700 mb-2"><%= @user.bio %></p>
            <% end %>
            
            <!-- Third line: Location and Company -->
            <div class="flex items-center gap-4 text-sm text-gray-400">
              <% if @user.location.present? %>
                <%= link_to users_path(location: @user.location), class: "flex items-center hover:text-gray-600 transition-colors" do %>
                  <%= inline_svg_tag "location.svg", class: "w-4 h-4 mr-1" %>
                  <%= @user.location %>
                <% end %>
              <% end %>
              
              <% if @user.company.present? %>
                <%= link_to users_path(company: @user.company), class: "flex items-center hover:text-gray-600 transition-colors" do %>
                  <%= inline_svg_tag "building.svg", class: "w-4 h-4 mr-1" %>
                  <%= @user.company %>
                <% end %>
              <% end %>
            </div>
          </div>
        </div>
        
        <!-- Tabs on the right, aligned to bottom -->
        <nav class="flex flex-wrap gap-x-8 gap-y-2 flex-shrink-0" aria-label="Tabs">
          <a href="#"
             data-tabs-target="tab"
             data-tabs-name="projects"
             data-action="click->tabs#switch"
             class="text-gray-500 hover:text-gray-700 whitespace-nowrap py-4 px-1 border-b-4 border-transparent font-semibold text-lg md:text-xl lg:text-2xl transition-all duration-200 flex items-center gap-2"
             role="tab"
             aria-selected="false">
            <span>Projects</span>
            <span class="bg-gray-100 text-gray-700 px-2.5 py-0.5 rounded-full text-sm md:text-base font-semibold">
              <%= @ruby_repos.size %>
            </span>
          </a>
          
          <a href="#"
             data-tabs-target="tab"
             data-tabs-name="posts"
             data-action="click->tabs#switch"
             class="text-gray-500 hover:text-gray-700 whitespace-nowrap py-4 px-1 border-b-4 border-transparent font-semibold text-lg md:text-xl lg:text-2xl transition-all duration-200 flex items-center gap-2"
             role="tab"
             aria-selected="false">
            <span>Posts</span>
            <span id="posts-count-desktop" class="bg-gray-100 text-gray-700 px-2.5 py-0.5 rounded-full text-sm md:text-base font-semibold">
              <%= @user.published_posts_count %>
            </span>
          </a>
          
          <a href="#"
             data-tabs-target="tab"
             data-tabs-name="comments"
             data-action="click->tabs#switch"
             class="text-gray-500 hover:text-gray-700 whitespace-nowrap py-4 px-1 border-b-4 border-transparent font-semibold text-lg md:text-xl lg:text-2xl transition-all duration-200 flex items-center gap-2"
             role="tab"
             aria-selected="false">
            <span>Comments</span>
            <span class="bg-gray-100 text-gray-700 px-2.5 py-0.5 rounded-full text-sm md:text-base font-semibold">
              <%= @user.published_comments_count %>
            </span>
          </a>
        </nav>
      </div>
      
      <!-- Mobile layout: stacked -->
      <div class="md:hidden">
        <!-- User info full width on top -->
        <div class="mb-6">
          <div class="flex items-center gap-4 mb-4">
            <% if @user.avatar_url.present? %>
              <%= image_tag @user.avatar_url, alt: @user.display_name, class: "h-24 w-24 rounded-full flex-shrink-0" %>
            <% else %>
              <span class="h-24 w-24 rounded-full bg-gray-300 flex items-center justify-center text-4xl font-bold flex-shrink-0">
                <%= @user.display_name.first.upcase %>
              </span>
            <% end %>
            
            <div class="flex-1">
              <!-- Name and social links -->
              <h1 class="text-3xl font-bold text-gray-900 mb-1"><%= @user.display_name %></h1>
              
              <!-- Social Links -->
              <% if @user.social_links.any? %>
                <div class="flex items-center gap-2">
                  <% @user.social_links.each do |platform, url| %>
                    <% next unless url.present? %>
                    <%= link_to url, target: "_blank", rel: "noopener", class: "text-gray-400 hover:text-gray-600" do %>
                      <% case platform %>
                      <% when :github %>
                        <%= inline_svg_tag "github.svg", class: "w-5 h-5" %>
                      <% when :twitter %>
                        <%= inline_svg_tag "twitter.svg", class: "w-5 h-5" %>
                      <% when :website %>
                        <%= inline_svg_tag "globe.svg", class: "w-5 h-5" %>
                      <% when :linkedin %>
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                          <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                        </svg>
                      <% end %>
                    <% end %>
                  <% end %>
                </div>
              <% end %>
            </div>
          </div>
          
          <!-- Bio -->
          <% if @user.bio.present? %>
            <p class="text-gray-700 mb-3"><%= @user.bio %></p>
          <% end %>
          
          <!-- Location and Company -->
          <div class="flex items-center gap-4 text-sm text-gray-400">
            <% if @user.location.present? %>
              <%= link_to users_path(location: @user.location), class: "flex items-center hover:text-gray-600 transition-colors" do %>
                <%= inline_svg_tag "location.svg", class: "w-4 h-4 mr-1" %>
                <%= @user.location %>
              <% end %>
            <% end %>
            
            <% if @user.company.present? %>
              <%= link_to users_path(company: @user.company), class: "flex items-center hover:text-gray-600 transition-colors" do %>
                <%= inline_svg_tag "building.svg", class: "w-4 h-4 mr-1" %>
                <%= @user.company %>
              <% end %>
            <% end %>
          </div>
        </div>
        
        <!-- Tabs left-aligned below -->
        <nav class="flex gap-x-6" aria-label="Tabs">
          <a href="#"
             data-tabs-target="tab"
             data-tabs-name="projects"
             data-action="click->tabs#switch"
             class="text-gray-500 hover:text-gray-700 whitespace-nowrap py-3 px-1 border-b-2 border-transparent font-semibold text-base transition-all duration-200 flex items-center gap-2"
             role="tab"
             aria-selected="false">
            <span>Projects</span>
            <span class="bg-gray-100 text-gray-700 px-2 py-0.5 rounded-full text-xs font-semibold">
              <%= @ruby_repos.size %>
            </span>
          </a>
          
          <a href="#"
             data-tabs-target="tab"
             data-tabs-name="posts"
             data-action="click->tabs#switch"
             class="text-gray-500 hover:text-gray-700 whitespace-nowrap py-3 px-1 border-b-2 border-transparent font-semibold text-base transition-all duration-200 flex items-center gap-2"
             role="tab"
             aria-selected="false">
            <span>Posts</span>
            <span id="posts-count-mobile" class="bg-gray-100 text-gray-700 px-2 py-0.5 rounded-full text-xs font-semibold">
              <%= @user.published_posts_count %>
            </span>
          </a>
          
          <a href="#"
             data-tabs-target="tab"
             data-tabs-name="comments"
             data-action="click->tabs#switch"
             class="text-gray-500 hover:text-gray-700 whitespace-nowrap py-3 px-1 border-b-2 border-transparent font-semibold text-base transition-all duration-200 flex items-center gap-2"
             role="tab"
             aria-selected="false">
            <span>Comments</span>
            <span class="bg-gray-100 text-gray-700 px-2 py-0.5 rounded-full text-xs font-semibold">
              <%= @user.published_comments_count %>
            </span>
          </a>
        </nav>
      </div>
    </div>

    <!-- Tab Panels -->
    <div class="mt-8">
      <!-- Projects Tab Panel -->
      <div data-tabs-target="panel" data-tabs-name="projects" role="tabpanel" class="hidden">
        <% if @ruby_repos.any? %>
          <div class="space-y-4">
            <!-- Desktop: 3 columns -->
            <div class="hidden lg:flex gap-6">
              <% # Split repositories into 3 columns for desktop, maintaining left-to-right reading order %>
              <% column1_repos = [] %>
              <% column2_repos = [] %>
              <% column3_repos = [] %>
              
              <% @ruby_repos.each_with_index do |repo, index| %>
                <% case index % 3 %>
                <% when 0 %>
                  <% column1_repos << repo %>
                <% when 1 %>
                  <% column2_repos << repo %>
                <% when 2 %>
                  <% column3_repos << repo %>
                <% end %>
              <% end %>
              
              <% [column1_repos, column2_repos, column3_repos].each do |column_repos| %>
                <div class="flex-1 space-y-6">
                  <% column_repos.each do |repository| %>
                    <%= render 'users/repository_tile', repository: repository %>
                  <% end %>
                </div>
              <% end %>
            </div>
            
            <!-- Tablet: 2 columns -->
            <div class="hidden md:flex lg:hidden gap-6">
              <% column1_repos = [] %>
              <% column2_repos = [] %>
              
              <% @ruby_repos.each_with_index do |repo, index| %>
                <% if index % 2 == 0 %>
                  <% column1_repos << repo %>
                <% else %>
                  <% column2_repos << repo %>
                <% end %>
              <% end %>
              
              <% [column1_repos, column2_repos].each do |column_repos| %>
                <div class="flex-1 space-y-6">
                  <% column_repos.each do |repository| %>
                    <%= render 'users/repository_tile', repository: repository %>
                  <% end %>
                </div>
              <% end %>
            </div>
            
            <!-- Mobile: 1 column -->
            <div class="md:hidden space-y-6">
              <% @ruby_repos.each do |repository| %>
                <%= render 'users/repository_tile', repository: repository %>
              <% end %>
            </div>
            
            <% if @user.github_ruby_repositories_url.present? %>
              <div class="mt-8 text-center">
                <%= link_to t('users.show.view_all_repositories'), @user.github_ruby_repositories_url, 
                    target: "_blank", rel: "noopener", class: "text-gray-400 hover:text-gray-600" %>
              </div>
            <% end %>
          </div>
        <% else %>
          <div class="bg-white shadow rounded-lg p-8 text-center">
            <p class="text-gray-600"><%= t('users.show.no_ruby_projects') %></p>
            <% if @user.github_profile_url.present? %>
              <p class="mt-2">
                <%= link_to t('users.show.view_github_profile'), @user.github_profile_url, 
                    target: "_blank", rel: "noopener", class: "text-gray-600 hover:text-gray-800" %>
              </p>
            <% end %>
          </div>
        <% end %>
      </div>

      <!-- Posts Tab Panel -->
      <div data-tabs-target="panel" data-tabs-name="posts" role="tabpanel" class="hidden">
        <% if @posts.any? %>
          <div class="space-y-4">
            <!-- Desktop: 3 columns -->
            <div class="hidden lg:flex gap-6">
              <% # Split posts into 3 columns for desktop, maintaining left-to-right reading order %>
              <% column1_posts = [] %>
              <% column2_posts = [] %>
              <% column3_posts = [] %>
              
              <% @posts.each_with_index do |post, index| %>
                <% case index % 3 %>
                <% when 0 %>
                  <% column1_posts << post %>
                <% when 1 %>
                  <% column2_posts << post %>
                <% when 2 %>
                  <% column3_posts << post %>
                <% end %>
              <% end %>
              
              <% [column1_posts, column2_posts, column3_posts].each do |column_posts| %>
                <div class="flex-1 space-y-6">
                  <% column_posts.each do |post| %>
                    <%= render 'posts/post_tile', post: post %>
                  <% end %>
                </div>
              <% end %>
            </div>
            
            <!-- Tablet: 2 columns -->
            <div class="hidden md:flex lg:hidden gap-6">
              <% column1_posts = [] %>
              <% column2_posts = [] %>
              
              <% @posts.each_with_index do |post, index| %>
                <% if index % 2 == 0 %>
                  <% column1_posts << post %>
                <% else %>
                  <% column2_posts << post %>
                <% end %>
              <% end %>
              
              <% [column1_posts, column2_posts].each do |column_posts| %>
                <div class="flex-1 space-y-6">
                  <% column_posts.each do |post| %>
                    <%= render 'posts/post_tile', post: post %>
                  <% end %>
                </div>
              <% end %>
            </div>
            
            <!-- Mobile: 1 column -->
            <div class="md:hidden space-y-6">
              <% @posts.each do |post| %>
                <%= render 'posts/post_tile', post: post %>
              <% end %>
            </div>
            
            <div class="mt-8">
              <%= paginate @posts %>
            </div>
          </div>
        <% else %>
          <div class="bg-white shadow rounded-lg p-8 text-center">
            <p class="text-gray-600">No published posts yet.</p>
          </div>
        <% end %>
      </div>

      <!-- Comments Tab Panel -->
      <div data-tabs-target="panel" data-tabs-name="comments" role="tabpanel" class="hidden">
        <% if @comments && @comments.any? %>
          <div class="space-y-4">
            <!-- Desktop: 3 columns -->
            <div class="hidden lg:flex gap-6">
              <% # Split comments into 3 columns for desktop, maintaining left-to-right reading order %>
              <% column1_comments = [] %>
              <% column2_comments = [] %>
              <% column3_comments = [] %>
              
              <% @comments.each_with_index do |comment, index| %>
                <% case index % 3 %>
                <% when 0 %>
                  <% column1_comments << comment %>
                <% when 1 %>
                  <% column2_comments << comment %>
                <% when 2 %>
                  <% column3_comments << comment %>
                <% end %>
              <% end %>
              
              <% [column1_comments, column2_comments, column3_comments].each do |column_comments| %>
                <div class="flex-1 space-y-6">
                  <% column_comments.each do |comment| %>
                    <%= render 'comments/comment_tile', comment: comment %>
                  <% end %>
                </div>
              <% end %>
            </div>
            
            <!-- Tablet: 2 columns -->
            <div class="hidden md:flex lg:hidden gap-6">
              <% column1_comments = [] %>
              <% column2_comments = [] %>
              
              <% @comments.each_with_index do |comment, index| %>
                <% if index % 2 == 0 %>
                  <% column1_comments << comment %>
                <% else %>
                  <% column2_comments << comment %>
                <% end %>
              <% end %>
              
              <% [column1_comments, column2_comments].each do |column_comments| %>
                <div class="flex-1 space-y-6">
                  <% column_comments.each do |comment| %>
                    <%= render 'comments/comment_tile', comment: comment %>
                  <% end %>
                </div>
              <% end %>
            </div>
            
            <!-- Mobile: 1 column -->
            <div class="md:hidden space-y-6">
              <% @comments.each do |comment| %>
                <%= render 'comments/comment_tile', comment: comment %>
              <% end %>
            </div>
            
            <div class="mt-8">
              <%= paginate @comments %>
            </div>
          </div>
        <% else %>
          <div class="bg-white shadow rounded-lg p-8 text-center">
            <p class="text-gray-600">No comments yet.</p>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>