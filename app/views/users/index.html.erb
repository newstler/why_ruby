<%# Set page title %>
<% content_for(:title) { t('meta.users.index.title') } %>

<%# Override meta tags for community page %>
<% content_for :head do %>
  <!-- SEO Meta Tags -->
  <meta name="description" content="<%= t('meta.users.index.summary') %>">
  <meta name="keywords" content="<%= t('meta.users.index.keywords') %>">
  <link rel="canonical" href="<%= users_url %>">
  
  <!-- Open Graph / Facebook Meta Tags -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="<%= users_url %>">
  <meta property="og:title" content="<%= full_page_title(t('meta.users.index.title')) %>">
  <meta property="og:description" content="<%= t('meta.users.index.summary') %>">
  <meta property="og:image" content="<%= versioned_og_image_url %>">
  <meta property="og:site_name" content="<%= t('meta.site.name') %>">
  <meta property="og:locale" content="<%= I18n.locale.to_s.gsub('-', '_') %>">
  
  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="<%= users_url %>">
  <meta name="twitter:title" content="<%= full_page_title(t('meta.users.index.title')) %>">
  <meta name="twitter:description" content="<%= t('meta.users.index.summary') %>">
  <meta name="twitter:image" content="<%= versioned_og_image_url %>">
  <meta name="twitter:site" content="<%= t('meta.social.twitter_site') %>">
  <meta name="twitter:creator" content="<%= t('meta.social.twitter_creator') %>">
<% end %>

<div class="space-y-8">
  <!-- Header -->
  <h1 class="text-4xl font-black text-gray-900 mb-4"><%= t('users.index.title') %></h1>
  <p class="text-lg text-gray-600">
    <%= t('users.index.description') %>
  </p>

  <!-- Active Filters -->
  <% if @filter_location.present? || @filter_company.present? %>
    <div class="bg-gray-50 rounded-lg py-4">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-2">
          <span class="text-sm text-gray-600">Filtering by:</span>
          <% if @filter_location.present? %>
            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-white border border-gray-300">
              <%= inline_svg_tag "location.svg", class: "w-3.5 h-3.5 mr-1 text-gray-500" %>
              <%= @filter_location %>
              <%= link_to "Ã—", users_path(company: @filter_company), class: "ml-2 text-gray-400 hover:text-gray-600 text-lg leading-none" %>
            </span>
          <% end %>
          <% if @filter_company.present? %>
            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-white border border-gray-300">
              <%= inline_svg_tag "building.svg", class: "w-3.5 h-3.5 mr-1 text-gray-500" %>
              <%= @filter_company %>
              <%= link_to "Ã—", users_path(location: @filter_location), class: "ml-2 text-gray-400 hover:text-gray-600 text-lg leading-none" %>
            </span>
          <% end %>
        </div>
      </div>
    </div>
  <% end %>

  <!-- Community Members Grid -->
  <div class="space-y-6">
    <!-- Desktop: 3 columns -->
    <div class="hidden lg:flex gap-6">
      <% # Split users into 3 columns for desktop, maintaining left-to-right reading order %>
      <% column1_users = [] %>
      <% column2_users = [] %>
      <% column3_users = [] %>
      
      <% @users.each_with_index do |user, index| %>
        <% case index % 3 %>
        <% when 0 %>
          <% column1_users << user %>
        <% when 1 %>
          <% column2_users << user %>
        <% when 2 %>
          <% column3_users << user %>
        <% end %>
      <% end %>
      
      <% [column1_users, column2_users, column3_users].each do |column_users| %>
        <div class="flex-1 space-y-6">
          <% column_users.each do |user| %>
            <%= render 'users/user_tile', user: user %>
          <% end %>
        </div>
      <% end %>
    </div>
    
    <!-- Tablet: 2 columns -->
    <div class="hidden md:flex lg:hidden gap-6">
      <% column1_users = [] %>
      <% column2_users = [] %>
      
      <% @users.each_with_index do |user, index| %>
        <% if index % 2 == 0 %>
          <% column1_users << user %>
        <% else %>
          <% column2_users << user %>
        <% end %>
      <% end %>
      
      <% [column1_users, column2_users].each do |column_users| %>
        <div class="flex-1 space-y-6">
          <% column_users.each do |user| %>
            <%= render 'users/user_tile', user: user %>
          <% end %>
        </div>
      <% end %>
    </div>
    
    <!-- Mobile: 1 column -->
    <div class="md:hidden space-y-6">
      <% @users.each do |user| %>
        <%= render 'users/user_tile', user: user %>
      <% end %>
    </div>
  </div>

  <!-- Community CTA -->
  <% if user_signed_in? %>
    <div class="mt-12 mb-8 text-center">
      <% tweet_text = "Join us and share what you love about Ruby! https://whyruby.info" %>
      <%= link_to t('users.index.invite_friends'), 
          "https://x.com/intent/tweet?text=#{CGI.escape(tweet_text)}", 
          target: "_blank",
          rel: "noopener",
          class: "text-gray-400 hover:text-gray-600 transition-colors" %>
    </div>
  <% else %>
    <div class="mt-12 mb-8 text-center">
      <%= link_to t('users.index.join_community'), 
          github_auth_with_return_path,
          class: "text-gray-400 hover:text-gray-600 transition-colors" %>
    </div>
  <% end %>

  <!-- Pagination -->
  <% if @users.total_pages > 1 %>
    <div class="mt-12 flex justify-center">
      <%= paginate @users %>
    </div>
  <% end %>
</div>